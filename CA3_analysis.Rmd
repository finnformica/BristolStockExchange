---
title: CA3 Analysis
---

```{r}
library(tidyverse)
```

## Exploratory Data Analysis

### Load data into data frame

```{r}
# load in avg profits for each trader
# each row corresponds to a trial
profits <- read.csv('profits.csv') %>%
  tibble::rowid_to_column("num_trials")
head(profits, 4)
nrow(profits)
```

### Pivot data frame longer

```{r}
profits_long <- profits %>% 
  pivot_longer(!num_trials, 
               names_to = "Trader", 
               values_to = "Profit")

head(profits_long)
```

### Generate summary table

```{r}
summary(profits %>% select(-num_trials))
```

NB: at a quick glance, SHVR has the highest average (average) profits across all experiments, whereas ZIP has the highest  (average) profits. SNPR does not seem to perform too well which is likely due to a longer experiment time in which it would only trade right at the end.

### Generate a box plot

- Quick glance at the data

```{r}
# generate box plot
ggplot() + geom_boxplot(data=profits_long, aes(Trader, Profit, fill=Trader)) + theme_bw()
```

NB: the box plot shows that SHVR has quite a high average when compared with the rest of the traders, and SNPR has quite a low average compared when compared with the rest of the traders. The later statistical tests will determine if these differences are significant.

### Generate a density plot

- Compare the distributions of the traders average profits with a Gaussian distribution

```{r}
# define color values
colors <- c("GVWY"="red", "SHVR"="orange", "SNPR"="green", "ZIC"="blue", "ZIP"="magenta")

# generate density plot
ggplot() + geom_density(data=profits_long, aes(x=Profit, group=Trader, color=Trader, fill=Trader), alpha=.3) + 
  labs(y="Density", x="Average profit", color="Trader") +
  theme_bw() + scale_color_manual(values=colors) + facet_grid(. ~ Trader, scales="free")
```

The density plot shows that a Gaussian model would be reasonable:
- the data looks unimodal across all samples (a single peak)
- the samples looks symmetric about their peaks


### Generate a QQ-plot

- Compare the quantiles in the sample with the theoretical quantiles of a Gaussian distribution

```{r}
ggplot(data=profits_long, aes(sample=Profit, group=Trader, color=Trader)) + stat_qq() + theme_bw() + stat_qq_line(color="black", linetype="dashed") + scale_color_manual(values=colors) + facet_grid(. ~ Trader, scales="free")
```

The QQ-plot verifies the use of a Gaussian model, if the points of the samples lie close to a straight line then a Gaussian model is reasonable.

### Shapiro-Wilk test

- Another test for Gaussian distribution

```{r}
# alpha = 0.05
apply(profits %>% select(-num_trials), 2, shapiro.test)
```

NB: ZIC has the lowest p-value out of the traders, however, none of them are statistically significant.


## Hypothesis Testing

With an assumption of the distribution of the data and the sample statistics, we can begin with the hypothesis test. The hypothesis is:

- ZIP is still the most profitable trader, even amongst these newer trading agents (GVWY, SHVR, SNPR).

To test this, a statistical technique that compares differences in means and spreads of the distribution across samples is required. Pairwise T-tests would not be suitable as this causes an increase in the family-wise error rate, and hence, there would be a high chance of incorrectly rejecting the null hypothesis. Instead, a test that measures all of the samples against each other at the same time is required. The **ANOVA** test is suitable for this, however, a few assumptions need to be made:

1. The ANOVA test can only be conducted if the subjects in each sample are independent.
2. Each group must have an equal sample size.
3. The data must have a Gaussian distribution.

Reviewing the EDA completed above, the data fits all of the requirements for the ANOVA test.

### ANOVA Hypothesis Test

To set up the ANOVA test, $H_0$ and $H_1$ need to be defined:

- Null hypothesis, $H_0$: all population means are equal.
- Alternate hypothesis, $H_1$: at least one population mean is different from the others.

The one-way ANOVA test will be used since there is only one independent variable that will be checked, the Trading Agent. The dependent variable is the Profit of the agent.


```{r}
# using the default significance of alpha = 0.05
res.aov <- aov(Profit ~ Trader, profits_long)

# display summary of ANOVA test
summary(res.aov)
```

The summary shows that there is high significance within the data denoted by the three *'s (corresponding to a 0.001 significance level), and the p-value of the Trader summary is much less than 0.05. This means that we can reject the null hypothesis and there is at least one population mean that is different from the others.

However, a drawback of the ANOVA test is that it cannot identify which population mean differs from the rest, and in what direction - i.e. is the trader more or less profitable than the others?. To determine this a post-hoc Tukey HSD test will be used. Tukey's test performs multiple pairwise comparisons between groups but accounts for the issues described earlier with the pairwise T-test.

### Post-hoc Tukey's HSD

```{r}
thsd <- TukeyHSD(res.aov)
thsd
```

NB: Both SNPR and SHVR have statistically significant p-values in relation with almost all other traders (the only exception being ZIP-SHVR). This is in line with the discussion about the box plots. ZIP and ZIC are also shown to have a statistically significant difference in their means.


```{r}
# plot confidence intervals
plot(thsd, las=1, cex.axis=0.5)
```

### Kruskal-Wallis Hypothesis Test

The ANOVA and Tukey's HSD tests have shown that there is a clear and significant difference between the means of the samples. Although the data is not skewed there are some extreme cases between all of the samples which may cause issues with the ANOVA test. Since the Kruskal-Wallis test is less sensitive to outliers than ANOVA it is reasonable to conduct this test. The assumptions for the Kruskal-Wallis test are:

1. Ordinal or continuous response variable
2. Observations in each group are independent
3. Distributions have a similar shape to each other.

Since the data meets these assumptions, the test can proceed.

The hypotheses for the Kruskal-Wallis test are similar to the ANOVA test:

- Null hypothesis, $H_0$: all population mean ranks are equal.
- Alternate hypothesis, $H_1$: at least one population mean rank is different from the others.

```{r}
kruskal.test(profits %>% select(-num_trials))
```

NB: very small p-value, statistically significant result. Hence, the null hypothesis can be rejected and there is at least one population mean rank that is different to the others.

This result validates the ANOVA test.






















